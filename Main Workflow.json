{
  "name": "Main Workflow",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "=Analyze the following garment DPP batch data and determine batch compliance: {{ JSON.stringify($json.batchId, null, 2) }}.\n",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Use the provided data and consult the DPP_knowledge tool before assessing whether a shipment should be flagged."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -1328,
        20624
      ],
      "id": "3e0669d2-0d5a-4605-a405-924d1e791e8e",
      "name": "batch compliance agent"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "79fcc4d3-88dd-41a4-8aaf-f1a3389d1a92",
              "leftValue": "={{ $json._missingCheck.ok }}",
              "rightValue": 0,
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -3488,
        21040
      ],
      "id": "6d1ffb71-3d46-4892-9fa8-4a0d161992ae",
      "name": "If Complete"
    },
    {
      "parameters": {
        "operation": "sendAndWait",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        -3312,
        21264
      ],
      "id": "5436ad71-a2de-47a4-a77a-2b8f162b5b39",
      "name": "Send email",
      "webhookId": "3b30b990-bc11-460d-837e-ea815f4825c6"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Determine whether the shipment should be flagged by evaluating the combined outputs of the batch compliance agent and the route compliance agent, and return the result as structured JSON only.\n\nCombined inputs for agent: ( {{ $json.output_1.isFlagged }} {{ $json.output_1.reason }} {{ $json.output_2 }} {{ $json.output_2.reason }} {{ $json.output_2.includedCities }} {{ $json.output_2.severity }} {{ $json.output_2.recommendations }} {{ $json.output_1.includedBatches }} {{ $json.output_1.severity }} {{ $json.output_1.recommendations }}) \n",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Output decision as PROCEED, DELAY, or BLOCK."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -272,
        20896
      ],
      "id": "9b2ec70a-0f2b-4e2e-9e62-c1687597d4ed",
      "name": "Decision Agent1"
    },
    {
      "parameters": {
        "jsCode": "function isMissing(v) {\n  if (v === null || v === undefined) return true;\n  if (typeof v === \"string\" && v.trim() === \"\") return true;\n  if (Array.isArray(v) && v.length === 0) return true;\n  return false;\n}\n\nconst allowNullPathPrefixes = [\n  \"batches[].orders[].garments[].dpp.collection.collectionPartner\",\n  \"batches[].orders[].garments[].dpp.recycling.recyclingProcess\",\n];\n\nconst REQUIRED = {\n  shipment: [\"shipmentId\", \"origin\", \"destination\", \"route\", \"distanceKm\", \"timeHours\", \"costEUR\", \"priority\", \"batches\"],\n  batch: [\"batchId\", \"shipmentId\", \"timestamp\", \"orders\"],\n  order: [\"id\", \"batchId\", \"brand\", \"quantity\", \"garments\"],\n  garment: [\"id\", \"orderId\", \"dpp\"],\n  dpp: [\n    \"uuid\",\n    \"rawMaterialsAndProcess\",\n    \"rawMaterialsConversion\",\n    \"component\",\n    \"productAssembly\",\n    \"finishedProduct\",\n    \"distribution\",\n    \"usage\",\n    \"afterSale\",\n    \"collection\",\n    \"recycling\",\n    \"endOfLife\",\n    \"transports\",\n    \"evaluations\",\n  ],\n};\n\nfunction pathAllowedNull(path) {\n  return allowNullPathPrefixes.some((p) => path.startsWith(p));\n}\n\nfunction addIssue(issues, path, reason, value) {\n  if (value === null && pathAllowedNull(path)) return;\n  issues.push({ path, reason, value });\n}\n\nfunction checkObjectRequired(obj, requiredKeys, basePath, issues) {\n  for (const key of requiredKeys) {\n    const v = obj?.[key];\n    const p = `${basePath}.${key}`;\n    if (isMissing(v)) addIssue(issues, p, \"missing/empty\", v);\n  }\n}\n\nfunction computeIssuesForItem(data) {\n  const shipments = Array.isArray(data) ? data : [data];\n  const issues = [];\n\n  shipments.forEach((s, si) => {\n    const sPath = Array.isArray(data) ? `[${si}]` : \"shipment\";\n\n    checkObjectRequired(s, REQUIRED.shipment, sPath, issues);\n\n    if (Array.isArray(s?.route)) {\n      s.route.forEach((r, ri) => {\n        if (isMissing(r)) addIssue(issues, `${sPath}.route[${ri}]`, \"missing/empty\", r);\n      });\n    }\n\n    (s?.batches || []).forEach((b, bi) => {\n      const bPath = `${sPath}.batches[${bi}]`;\n      checkObjectRequired(b, REQUIRED.batch, bPath, issues);\n\n      (b?.orders || []).forEach((o, oi) => {\n        const oPath = `${bPath}.orders[${oi}]`;\n        checkObjectRequired(o, REQUIRED.order, oPath, issues);\n\n        (o?.garments || []).forEach((g, gi) => {\n          const gPath = `${oPath}.garments[${gi}]`;\n          checkObjectRequired(g, REQUIRED.garment, gPath, issues);\n\n          const dpp = g?.dpp;\n          const dppPath = `${gPath}.dpp`;\n          if (isMissing(dpp)) {\n            addIssue(issues, dppPath, \"missing/empty\", dpp);\n            return;\n          }\n\n          checkObjectRequired(dpp, REQUIRED.dpp, dppPath, issues);\n\n          const nested = [\n            { obj: dpp.rawMaterialsAndProcess, keys: [\"sourceCountry\", \"materialType\", \"supplier\", \"harvestDate\", \"certifications\"], path: `${dppPath}.rawMaterialsAndProcess` },\n            { obj: dpp.rawMaterialsConversion, keys: [\"processingFacility\", \"location\", \"processDate\", \"processType\"], path: `${dppPath}.rawMaterialsConversion` },\n            { obj: dpp.finishedProduct, keys: [\"productId\", \"completionDate\", \"qualityGrade\"], path: `${dppPath}.finishedProduct` },\n            { obj: dpp.evaluations, keys: [\"esgRating\", \"certifications\", \"lastAuditDate\", \"complianceScore\"], path: `${dppPath}.evaluations` },\n          ];\n\n          nested.forEach(({ obj, keys, path }) => {\n            if (isMissing(obj)) {\n              addIssue(issues, path, \"missing/empty\", obj);\n              return;\n            }\n            keys.forEach((k) => {\n              const v = obj[k];\n              const p = `${path}.${k}`;\n              if (isMissing(v)) addIssue(issues, p, \"missing/empty\", v);\n            });\n          });\n        });\n      });\n    });\n  });\n\n  return issues;\n}\n\nreturn $input.all().map((item, idx) => {\n  const issues = computeIssuesForItem(item.json);\n  return {\n    json: {\n      ...item.json, // original data stays here\n      _missingCheck: {\n        ok: issues.length === 0,\n        missingCount: issues.length,\n        missing: issues.slice(0, 200),\n      },\n    },\n  };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3664,
        21040
      ],
      "id": "d606ee33-f1a2-4bdd-881f-aeee3023b3a3",
      "name": "DPP Missing Data Check"
    },
    {
      "parameters": {
        "jsCode": "// Expecting input shape:\n// shipments â†’ batches â†’ orders â†’ garments\n\nconst shipments = $json.shipments || [];\nconst batchMap = {};\n\n// Walk the structure\nfor (const shipment of shipments) {\n  for (const batch of shipment.batches || []) {\n    const batchId = batch.batchId;\n\n    if (!batchMap[batchId]) {\n      batchMap[batchId] = {\n        batchId,\n        shipmentId: shipment.shipmentId,\n        origin: shipment.origin,\n        destination: shipment.destination,\n        orders: {}\n      };\n    }\n\n    for (const order of batch.orders || []) {\n      const orderId = order.orderId;\n\n      if (!batchMap[batchId].orders[orderId]) {\n        batchMap[batchId].orders[orderId] = {\n          orderId,\n          brand: order.brand || null,\n          quantity: order.quantity || null,\n          garments: []\n        };\n      }\n\n      for (const garment of order.garments || []) {\n        batchMap[batchId].orders[orderId].garments.push({\n          id: garment.id,\n          orderId: garment.orderId,\n          dpp: garment.dpp || null\n        });\n      }\n    }\n  }\n}\n\n// Convert map â†’ n8n items\nreturn Object.values(batchMap).map(batch => ({\n  json: {\n    batchId: batch.batchId,\n    shipmentId: batch.shipmentId,\n    origin: batch.origin,\n    destination: batch.destination,\n    orders: Object.values(batch.orders)\n  }\n}));\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2416,
        20608
      ],
      "id": "6e76bb35-923c-4c39-b0af-512912ec68f6",
      "name": "Batch mapping"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5449a0c9-2ce0-4915-9ca0-dc37cf5f36da",
              "name": "decision",
              "value": "=FLAGGED AS {{ $json.decision }}",
              "type": "string"
            },
            {
              "id": "6604a565-608b-4c39-9d4e-c38d93c58860",
              "name": "reason",
              "value": "={{ $json.reasons }}",
              "type": "string"
            },
            {
              "id": "a3405fa2-f295-499b-8d6b-f1208a62b13f",
              "name": "confidence",
              "value": "={{ $json.confidence }} % sure of decision",
              "type": "string"
            },
            {
              "id": "fdfdc5cb-12d2-4cb3-adbb-7c151149d16d",
              "name": "required actions",
              "value": "={{ $json.requiredActions }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        912,
        20752
      ],
      "id": "d0b53866-b214-4c8b-9150-541b74c4f136",
      "name": "Generate feedback"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": []
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        928,
        20960
      ],
      "id": "ccbd5eff-4714-4c85-8c7c-d31ee5bc5ef1",
      "name": "Shipment authorized"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/13-2l41mEY9sUmbrhmUyKpPKykH4nw75n_YTQVwzrnBY/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "DDP Batch Logs",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13-2l41mEY9sUmbrhmUyKpPKykH4nw75n_YTQVwzrnBY/edit#gid=0"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {
            "Status": "={{ $json.status }}",
            "Rationale": "={{ $json.reason }}",
            "Constraints": "={{ $json.new_constraints }}",
            "BatchID": "={{ $json.batch_id }}",
            "Timestamp": "={{ $now }}"
          },
          "matchingColumns": [
            "BatchID"
          ],
          "schema": [
            {
              "id": "BatchID",
              "displayName": "BatchID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Rationale",
              "displayName": "Rationale",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Constraints",
              "displayName": "Constraints",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "decision",
              "displayName": "decision",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "reason",
              "displayName": "reason",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "confidence",
              "displayName": "confidence",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "required actions",
              "displayName": "required actions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1120,
        20752
      ],
      "id": "1805b076-2fdb-4d7f-aca6-f79b1705a200",
      "name": "Update sheet: FLAGGED",
      "credentials": {
        "googleApi": {
          "id": "62Ae2L7a03Gf9X11",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/13-2l41mEY9sUmbrhmUyKpPKykH4nw75n_YTQVwzrnBY/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "DDP Batch Logs",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/13-2l41mEY9sUmbrhmUyKpPKykH4nw75n_YTQVwzrnBY/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Status": "={{ $json.status }}",
            "Rationale": "={{ $json.reason }}",
            "Constraints": "None",
            "BatchID": "={{ $json.batch_id }}",
            "Timestamp": "={{ $now }}"
          },
          "matchingColumns": [
            "BatchID"
          ],
          "schema": [
            {
              "id": "BatchID",
              "displayName": "BatchID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Rationale",
              "displayName": "Rationale",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Constraints",
              "displayName": "Constraints",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1136,
        20960
      ],
      "id": "1431149e-1aab-42b8-b7a1-c4e7719c105f",
      "name": "Update sheet: GOOD",
      "credentials": {
        "googleApi": {
          "id": "62Ae2L7a03Gf9X11",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Assess forecast data, {{ JSON.stringify($json.forecast, null, 2) }} and cities data {{ $json.cities }} to assess whether a shipment route should be flagged or not.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Use the input data to assess route compliance and consult the Route_Knowledge tool before assessing compliance."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -1328,
        21104
      ],
      "id": "53a0f453-61f1-4155-bbdd-6c156d9b35cf",
      "name": "route compliance agent"
    },
    {
      "parameters": {},
      "id": "3f07a521-5313-4387-8d27-d90288546d08",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -5504,
        21056
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({ status: 'success', decision: 'FLAGGED', shipmentId: $json.batch_id, rationale: $json.reason, solver_updates: $json.new_constraints, routeAssessment: JSON.parse($json.routeAssessment || '{}'), batchAssessment: JSON.parse($json.batchAssessment || '{}'), timestamp: new Date().toISOString() }) }}",
        "options": {}
      },
      "id": "a50112d0-28cc-4a7d-af4d-5cc9c97163d9",
      "name": "Respond to Webhook FLAGGED",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        1424,
        20752
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({ status: 'success', decision: 'GOOD', shipmentId: $json.batch_id, rationale: $json.reason, solver_updates: $json.new_constraints, routeAssessment: JSON.parse($json.routeAssessment || '{}'), batchAssessment: JSON.parse($json.batchAssessment || '{}'), timestamp: new Date().toISOString() }) }}",
        "options": {}
      },
      "id": "9da5f885-8234-42fc-b8e1-0cb8f04d9b11",
      "name": "Respond to Webhook GOOD",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        1424,
        20960
      ]
    },
    {
      "parameters": {
        "url": "https://api.open-meteo.com/v1/forecast",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "latitude",
              "value": "={{ $json.latitude }}"
            },
            {
              "name": "=longitude",
              "value": "={{ $json.longitude }}"
            },
            {
              "name": "daily",
              "value": "weather_code,precipitation_sum"
            },
            {
              "name": "timezone",
              "value": "Europe/Berlin"
            },
            {
              "name": "city",
              "value": "={{$json.city || $json.name}}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -2464,
        21104
      ],
      "id": "bda9db11-cece-4a44-b821-0d7fe97d657d",
      "name": "weather forecast",
      "continueOnFail": true,
      "notes": "Fetches weather forecast. Continues on fail to handle API errors gracefully. Preserves city name from input."
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"schemaVersion\": \"1.0\",\n  \"description\": \"Synthetic logistics network edges (distance/time/cost) derived from city legs found in data.json routes and origin-destination pairs.\",\n  \"nodes\": [\n    {\n      \"city\": \"Algeciras\",\n      \"latitude\": 36.1408,\n      \"longitude\": -5.4562\n    },\n    {\n      \"city\": \"antwerp\",\n      \"latitude\": 51.2213,\n      \"longitude\": 4.4051\n    },\n    {\n      \"city\": \"Barcelona\",\n      \"latitude\": 41.3894,\n      \"longitude\": 2.1686\n    },\n    {\n      \"city\": \"Bremerhaven\",\n      \"latitude\": 53.5396,\n      \"longitude\": 8.5809\n    },\n    {\n      \"city\": \"Dunkirk\",\n      \"latitude\": 51.0344,\n      \"longitude\": 2.377\n    },\n    {\n      \"city\": \"Felixstowe\",\n      \"latitude\": 51.9636,\n      \"longitude\": 1.351\n    },\n    {\n      \"city\": \"Genoa\",\n      \"latitude\": 44.4056,\n      \"longitude\": 8.9463\n    },\n    {\n      \"city\": \"Gioia Tauro\",\n      \"latitude\": 38.4247,\n      \"longitude\": 15.901\n    },\n    {\n      \"city\": \"Hamburg\",\n      \"latitude\": 53.5461,\n      \"longitude\": 9.9661\n    },\n    {\n      \"city\": \"Le Havre\",\n      \"latitude\": 49.4939,\n      \"longitude\": 0.1079\n    },\n    {\n      \"city\": \"Marseille\",\n      \"latitude\": 43.2965,\n      \"longitude\": 5.3698\n    },\n    {\n      \"city\": \"Piraeus\",\n      \"latitude\": 37.9429,\n      \"longitude\": 23.6469\n    },\n    {\n      \"city\": \"Rotterdam\",\n      \"latitude\": 51.9496,\n      \"longitude\": 4.1383\n    },\n    {\n      \"city\": \"Valencia\",\n      \"latitude\": 39.4699,\n      \"longitude\": -0.3763\n    }\n  ],\n  \"edges\": [\n    {\n      \"from\": \"Algeciras\",\n      \"to\": \"antwerp\",\n      \"distanceKm\": 679.4,\n      \"timeHours\": 17.99,\n      \"costEUR\": 636.79,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Algeciras\",\n      \"to\": \"Valencia\",\n      \"distanceKm\": 2109.3,\n      \"timeHours\": 48.23,\n      \"costEUR\": 1691.87,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"antwerp\",\n      \"to\": \"Barcelona\",\n      \"distanceKm\": 2592.8,\n      \"timeHours\": 62.67,\n      \"costEUR\": 2301.46,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"antwerp\",\n      \"to\": \"Bremerhaven\",\n      \"distanceKm\": 406.8,\n      \"timeHours\": 7.28,\n      \"costEUR\": 403.61,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"antwerp\",\n      \"to\": \"Genoa\",\n      \"distanceKm\": 526.9,\n      \"timeHours\": 8.21,\n      \"costEUR\": 538.82,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"antwerp\",\n      \"to\": \"Hamburg\",\n      \"distanceKm\": 1889.1,\n      \"timeHours\": 30.15,\n      \"costEUR\": 1571.0,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"antwerp\",\n      \"to\": \"Piraeus\",\n      \"distanceKm\": 1437.0,\n      \"timeHours\": 34.96,\n      \"costEUR\": 1297.2,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"antwerp\",\n      \"to\": \"Rotterdam\",\n      \"distanceKm\": 1255.9,\n      \"timeHours\": 28.15,\n      \"costEUR\": 1387.65,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Barcelona\",\n      \"to\": \"antwerp\",\n      \"distanceKm\": 607.2,\n      \"timeHours\": 11.68,\n      \"costEUR\": 562.06,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Barcelona\",\n      \"to\": \"Hamburg\",\n      \"distanceKm\": 1984.0,\n      \"timeHours\": 43.86,\n      \"costEUR\": 1351.02,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"Barcelona\",\n      \"to\": \"Valencia\",\n      \"distanceKm\": 2531.3,\n      \"timeHours\": 42.91,\n      \"costEUR\": 2247.6,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"Dunkirk\",\n      \"to\": \"Bremerhaven\",\n      \"distanceKm\": 253.9,\n      \"timeHours\": 5.37,\n      \"costEUR\": 298.46,\n      \"mode\": \"road\"\n    },\n    {\n      \"from\": \"Dunkirk\",\n      \"to\": \"Le Havre\",\n      \"distanceKm\": 1955.0,\n      \"timeHours\": 36.16,\n      \"costEUR\": 1327.8,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Dunkirk\",\n      \"to\": \"Marseille\",\n      \"distanceKm\": 1308.9,\n      \"timeHours\": 24.39,\n      \"costEUR\": 967.3,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Felixstowe\",\n      \"to\": \"Gioia Tauro\",\n      \"distanceKm\": 1932.5,\n      \"timeHours\": 32.52,\n      \"costEUR\": 1707.46,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Felixstowe\",\n      \"to\": \"Le Havre\",\n      \"distanceKm\": 1613.9,\n      \"timeHours\": 30.4,\n      \"costEUR\": 1634.11,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Genoa\",\n      \"to\": \"Barcelona\",\n      \"distanceKm\": 1559.1,\n      \"timeHours\": 38.93,\n      \"costEUR\": 1042.59,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Genoa\",\n      \"to\": \"Hamburg\",\n      \"distanceKm\": 1388.4,\n      \"timeHours\": 22.65,\n      \"costEUR\": 760.62,\n      \"mode\": \"road\"\n    },\n    {\n      \"from\": \"Genoa\",\n      \"to\": \"Le Havre\",\n      \"distanceKm\": 791.0,\n      \"timeHours\": 14.67,\n      \"costEUR\": 606.34,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Genoa\",\n      \"to\": \"Rotterdam\",\n      \"distanceKm\": 2430.3,\n      \"timeHours\": 60.12,\n      \"costEUR\": 2137.76,\n      \"mode\": \"road\"\n    },\n    {\n      \"from\": \"Genoa\",\n      \"to\": \"Valencia\",\n      \"distanceKm\": 1274.5,\n      \"timeHours\": 27.24,\n      \"costEUR\": 937.5,\n      \"mode\": \"road\"\n    },\n    {\n      \"from\": \"Hamburg\",\n      \"to\": \"Dunkirk\",\n      \"distanceKm\": 2148.4,\n      \"timeHours\": 41.02,\n      \"costEUR\": 1946.15,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"Hamburg\",\n      \"to\": \"Felixstowe\",\n      \"distanceKm\": 373.7,\n      \"timeHours\": 8.88,\n      \"costEUR\": 544.34,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"Hamburg\",\n      \"to\": \"Valencia\",\n      \"distanceKm\": 562.2,\n      \"timeHours\": 8.69,\n      \"costEUR\": 640.78,\n      \"mode\": \"road\"\n    },\n    {\n      \"from\": \"Le Havre\",\n      \"to\": \"Barcelona\",\n      \"distanceKm\": 2303.0,\n      \"timeHours\": 39.78,\n      \"costEUR\": 2093.66,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Le Havre\",\n      \"to\": \"Felixstowe\",\n      \"distanceKm\": 2201.8,\n      \"timeHours\": 46.02,\n      \"costEUR\": 1517.92,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Le Havre\",\n      \"to\": \"Marseille\",\n      \"distanceKm\": 2034.7,\n      \"timeHours\": 46.96,\n      \"costEUR\": 1653.6,\n      \"mode\": \"road\"\n    },\n    {\n      \"from\": \"Le Havre\",\n      \"to\": \"Rotterdam\",\n      \"distanceKm\": 1722.6,\n      \"timeHours\": 28.48,\n      \"costEUR\": 1351.26,\n      \"mode\": \"road\"\n    },\n    {\n      \"from\": \"Le Havre\",\n      \"to\": \"Valencia\",\n      \"distanceKm\": 2294.2,\n      \"timeHours\": 63.12,\n      \"costEUR\": 2315.92,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Marseille\",\n      \"to\": \"Bremerhaven\",\n      \"distanceKm\": 491.2,\n      \"timeHours\": 11.02,\n      \"costEUR\": 483.11,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Marseille\",\n      \"to\": \"Le Havre\",\n      \"distanceKm\": 1526.7,\n      \"timeHours\": 25.34,\n      \"costEUR\": 1502.83,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Piraeus\",\n      \"to\": \"Genoa\",\n      \"distanceKm\": 781.5,\n      \"timeHours\": 12.04,\n      \"costEUR\": 698.82,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"Piraeus\",\n      \"to\": \"Le Havre\",\n      \"distanceKm\": 1818.6,\n      \"timeHours\": 28.19,\n      \"costEUR\": 1650.91,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"Rotterdam\",\n      \"to\": \"Algeciras\",\n      \"distanceKm\": 810.4,\n      \"timeHours\": 18.39,\n      \"costEUR\": 762.08,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Rotterdam\",\n      \"to\": \"antwerp\",\n      \"distanceKm\": 2150.6,\n      \"timeHours\": 34.99,\n      \"costEUR\": 1674.56,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Rotterdam\",\n      \"to\": \"Barcelona\",\n      \"distanceKm\": 1834.9,\n      \"timeHours\": 30.6,\n      \"costEUR\": 1002.13,\n      \"mode\": \"road\"\n    },\n    {\n      \"from\": \"Rotterdam\",\n      \"to\": \"Genoa\",\n      \"distanceKm\": 1503.3,\n      \"timeHours\": 32.24,\n      \"costEUR\": 1547.47,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Rotterdam\",\n      \"to\": \"Gioia Tauro\",\n      \"distanceKm\": 934.2,\n      \"timeHours\": 19.87,\n      \"costEUR\": 634.86,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Rotterdam\",\n      \"to\": \"Hamburg\",\n      \"distanceKm\": 2245.2,\n      \"timeHours\": 42.25,\n      \"costEUR\": 2046.29,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Valencia\",\n      \"to\": \"Algeciras\",\n      \"distanceKm\": 763.0,\n      \"timeHours\": 12.29,\n      \"costEUR\": 496.91,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Valencia\",\n      \"to\": \"Barcelona\",\n      \"distanceKm\": 2149.8,\n      \"timeHours\": 48.65,\n      \"costEUR\": 1788.85,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Valencia\",\n      \"to\": \"Dunkirk\",\n      \"distanceKm\": 1881.8,\n      \"timeHours\": 33.63,\n      \"costEUR\": 1428.85,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Valencia\",\n      \"to\": \"Genoa\",\n      \"distanceKm\": 2080.9,\n      \"timeHours\": 40.98,\n      \"costEUR\": 1924.31,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Valencia\",\n      \"to\": \"Piraeus\",\n      \"distanceKm\": 1213.6,\n      \"timeHours\": 19.91,\n      \"costEUR\": 812.96,\n      \"mode\": \"multimodal\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4384,
        21200
      ],
      "id": "93dd3238-1103-4101-82cf-363ebd004802",
      "name": "Logistics Network"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -4192,
        21040
      ],
      "id": "5416204c-0876-4411-9ac2-bd82286cd6a0",
      "name": "Merge Datasets1"
    },
    {
      "parameters": {
        "jsCode": "const ports = [\n  { city: \"Algeciras\", lat: 36.1408, lon: -5.4562 },\n  { city: \"Antwerp\", lat: 51.2213, lon: 4.4051 },\n  { city: \"Barcelona\", lat: 41.3894, lon: 2.1686 },\n  { city: \"Bremerhaven\", lat: 53.5396, lon: 8.5809 },\n  { city: \"Dunkirk\", lat: 51.0344, lon: 2.377 },\n  { city: \"Felixstowe\", lat: 51.9636, lon: 1.351 },\n  { city: \"Genoa\", lat: 44.4056, lon: 8.9463 },\n  { city: \"Gioia Tauro\", lat: 38.4247, lon: 15.901 },\n  { city: \"Hamburg\", lat: 53.5461, lon: 9.9661 },\n  { city: \"Le Havre\", lat: 49.4939, lon: 0.1079 },\n  { city: \"Marseille\", lat: 43.2965, lon: 5.3698 },\n  { city: \"Piraeus\", lat: 37.9429, lon: 23.6469 },\n  { city: \"Rotterdam\", lat: 51.9496, lon: 4.1383 },\n  { city: \"Valencia\", lat: 39.4699, lon: -0.3763 }\n];\n\nfunction distance(a, b) {\n  return Math.abs(a.lat - b.lat) + Math.abs(a.lon - b.lon);\n}\n\n// initialize aggregation buckets\nconst cities = Object.fromEntries(\n  ports.map(p => [\n    p.city,\n    {\n      city: p.city,\n      latitude: p.lat,\n      longitude: p.lon,\n      precipitation_mm: 0,\n      weather_codes: [],\n      risk_levels: [],\n      daily_units: null\n    }\n  ])\n);\n\n\n// assign forecast items to nearest city\nfor (const item of $input.all()) {\n  const lat = item.json.latitude;\n  const lon = item.json.longitude;\n\n  let closest = null;\n  let best = Infinity;\n\n  for (const p of ports) {\n    const d = distance({ lat, lon }, p);\n    if (d < best) {\n      best = d;\n      closest = p.city;\n    }\n  }\n\n  if (!closest) continue;\n\n  cities[closest].precipitation_mm += item.json.derived?.precipitation_mm ?? 0;\n  cities[closest].weather_codes.push(item.json.derived?.weather_code);\n  cities[closest].risk_levels.push(item.json.derived?.risk);\n}\n\n// finalize output (one row per city)\nreturn Object.values(cities).map(c => ({\n  json: {\n    city: c.city,\n    latitude: c.latitude,\n    longitude: c.longitude,\n    precipitation_mm: Number(c.precipitation_mm.toFixed(1)),\n    max_risk: c.risk_levels.includes(\"HIGH\")\n      ? \"HIGH\"\n      : c.risk_levels.includes(\"MEDIUM\")\n      ? \"MEDIUM\"\n      : \"LOW\",\n    weather_codes: [...new Set(c.weather_codes)].join(\", \")\n  }\n}));\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2080,
        21296
      ],
      "id": "119cc4ae-22da-4b3f-807a-faab83055a31",
      "name": "add cities"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1cEW_gLGy3h4RVbkBGpgxwKNr7PRKH0WkB3s9OfVQRUE/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1cEW_gLGy3h4RVbkBGpgxwKNr7PRKH0WkB3s9OfVQRUE/edit#gid=0"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [
            "shipments"
          ],
          "schema": [
            {
              "id": "shipments",
              "displayName": "shipments",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "schemaVersion",
              "displayName": "schemaVersion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "description",
              "displayName": "description",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nodes",
              "displayName": "nodes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "edges",
              "displayName": "edges",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -4048,
        20784
      ],
      "id": "c65f959d-25f2-41ea-ba34-59298c44ea43",
      "name": "Append or update row in sheet",
      "credentials": {
        "googleApi": {
          "id": "62Ae2L7a03Gf9X11",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "nodes",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -2672,
        21104
      ],
      "id": "c6245d07-b256-4094-b14a-9265efb9f25d",
      "name": "Split Out"
    },
    {
      "parameters": {
        "jsCode": "const output = [];\n\nfor (const item of $input.all()) {\n  const json = item.json ?? {};\n\n  const lat = json.latitude;\n  const lon = json.longitude;\n  if (lat == null || lon == null) continue;\n\n  const daily = json.daily;\n  if (!daily) {\n    // still pass through the full item unchanged\n    output.push({ json });\n    continue;\n  }\n\n  const precipitation = daily.precipitation_sum?.[0] ?? 0;\n  const weatherCode = daily.weather_code?.[0];\n\n  // ðŸ”‘ IMPORTANT: spread original payload, NO risk labels\n  output.push({\n    json: {\n      ...json,\n      derived: {\n        precipitation_mm: precipitation,\n        weather_code: weatherCode\n      }\n    }\n  });\n}\n\nreturn output;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2288,
        21104
      ],
      "id": "a6984206-813d-4e4b-a2d0-dbf9c4153746",
      "name": "Parse Weather & Assess Risk"
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    cities: $input.all().map(i => i.json)\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1856,
        21296
      ],
      "id": "b5bf6292-a3b0-4386-b511-5204b8cb877d",
      "name": "map input for agent"
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    batchId: $input.all().map(i => i.json)\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1952,
        20608
      ],
      "id": "47e3c0dc-83fb-49a7-9c4f-8fb574115049",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1vFkkY7zy5W79XNL2b0iLRm_Q-6k-eRAW7cJp_0-KpjA/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "forecast",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1vFkkY7zy5W79XNL2b0iLRm_Q-6k-eRAW7cJp_0-KpjA/edit#gid=0"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "city",
              "displayName": "city",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "latitude",
              "displayName": "latitude",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "longitude",
              "displayName": "longitude",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "precipitation_mm",
              "displayName": "precipitation_mm",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "max_risk",
              "displayName": "max_risk",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "weather_codes",
              "displayName": "weather_codes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "36.1875",
              "displayName": "36.1875",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "-5.4375",
              "displayName": "-5.4375",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "0.09632110596",
              "displayName": "0.09632110596",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "3600",
              "displayName": "3600",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Europe/Berlin",
              "displayName": "Europe/Berlin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "GMT+1",
              "displayName": "GMT+1",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "23",
              "displayName": "23",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "{\"time\":\"iso8601\",\"weather_code\":\"wmo code\",\"precipitation_sum\":\"mm\"}",
              "displayName": "{\"time\":\"iso8601\",\"weather_code\":\"wmo code\",\"precipitation_sum\":\"mm\"}",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "{\"time\":[\"2026-01-22\",\"2026-01-23\",\"2026-01-24\",\"2026-01-25\",\"2026-01-26\",\"2026-01-27\",\"2026-01-28\"],\"weather_code\":[61,80,3,63,61,80,80],\"precipitation_sum\":[1.4,27.3,0.1,31.4,15.7,50.75,37.8]}",
              "displayName": "{\"time\":[\"2026-01-22\",\"2026-01-23\",\"2026-01-24\",\"2026-01-25\",\"2026-01-26\",\"2026-01-27\",\"2026-01-28\"],\"weather_code\":[61,80,3,63,61,80,80],\"precipitation_sum\":[1.4,27.3,0.1,31.4,15.7,50.75,37.8]}",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "city",
              "displayName": "city",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "latitude",
              "displayName": "latitude",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "longitude",
              "displayName": "longitude",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "precipitation_mm",
              "displayName": "precipitation_mm",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "max_risk",
              "displayName": "max_risk",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "weather_codes",
              "displayName": "weather_codes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1856,
        21456
      ],
      "id": "2c6c04cf-61d1-47b3-a6dc-6afd5de17057",
      "name": "Append or update row in sheet2",
      "credentials": {
        "googleApi": {
          "id": "62Ae2L7a03Gf9X11",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Batch Compliane Agent",
        "height": 1056,
        "width": 2208
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2880,
        19984
      ],
      "typeVersion": 1,
      "id": "b162b398-c565-400a-8f4a-ecbd0173c6b6",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Route Compliance Agent",
        "height": 1280,
        "width": 2208
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2880,
        21056
      ],
      "typeVersion": 1,
      "id": "92427631-a6aa-482d-8b48-bc81b2274de9",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    forecast: $input.all().map(i => i.json)\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1856,
        21104
      ],
      "id": "30d506f4-7cc3-4bd7-8705-c6dbf51f3e92",
      "name": "map input for agent1"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -1568,
        21104
      ],
      "id": "8903e180-e4b0-4b00-8ebc-6192c36ebfe1",
      "name": "Merge1"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {
          "clashHandling": {
            "values": {
              "resolveClash": "addSuffix"
            }
          }
        }
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -496,
        20896
      ],
      "id": "d6a6ad00-0a4d-48b2-955c-897f845251d9",
      "name": "Merge2"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5-nano",
          "mode": "list"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -272,
        21072
      ],
      "id": "e0391750-9498-4fc6-be5c-6a6c651a8e16",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "p0NABpxvv7SHkRbU",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Decision Agent\n",
        "height": 1168,
        "width": 966
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -640,
        20480
      ],
      "id": "0205f524-0f97-4ade-be6b-52fca53e4dd4",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1Y6QYBWDM75xF9VZbgGTNeSFNec1cPJqRdffBzm9sTDs/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Y6QYBWDM75xF9VZbgGTNeSFNec1cPJqRdffBzm9sTDs/edit#gid=0"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [
            "output"
          ],
          "schema": [
            {
              "id": "output",
              "displayName": "output",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        112,
        20992
      ],
      "id": "3cd0d0e0-73e7-4afd-a8b6-f6e50ae81ddf",
      "name": "Append or update row in sheet3",
      "credentials": {
        "googleApi": {
          "id": "62Ae2L7a03Gf9X11",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "7b2ef4ff-0b6a-4257-a0fb-c77e235da117",
              "leftValue": "={{$json.output.isFlagged}}",
              "rightValue": "true",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        560,
        20848
      ],
      "id": "00f62ea5-45f4-47fc-b572-e801933cd85b",
      "name": "If"
    },
    {
      "parameters": {
        "content": "## Preprocessing\n",
        "height": 1152,
        "width": 1200
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -5008,
        20496
      ],
      "id": "b01af122-fc0c-4dcb-827f-e4e5cbcaa0e7",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "## Missing Data Check\n",
        "height": 1168,
        "width": 848
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3776,
        20480
      ],
      "id": "f3c4ec86-0fe3-40eb-ba6b-71d2fcdd59b9",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "## safe outputs for further evaluation by human\n",
        "height": 1168,
        "width": 1270
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        368,
        20480
      ],
      "id": "18b7b482-7c38-4c22-afdb-97b368cc3237",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1GTmUI60rUasN0Muw8TryvHFsprsSxLS8NGp6AbDdOTU/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1GTmUI60rUasN0Muw8TryvHFsprsSxLS8NGp6AbDdOTU/edit#gid=0"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [
            "output"
          ],
          "schema": [
            {
              "id": "output",
              "displayName": "output",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -832,
        20512
      ],
      "id": "a9142625-9a55-4080-a582-84a666f3c4fe",
      "name": "Append or update row in sheet4",
      "credentials": {
        "googleApi": {
          "id": "62Ae2L7a03Gf9X11",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1yiJVj6Ml2Ii3JV5krhtVDFNNUrApEImOl6FiRg5Bp6A/edit?usp=sharing",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1yiJVj6Ml2Ii3JV5krhtVDFNNUrApEImOl6FiRg5Bp6A/edit#gid=0"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [
            "output"
          ],
          "schema": [
            {
              "id": "output",
              "displayName": "output",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -816,
        21312
      ],
      "id": "cd099325-2ca3-4945-9ff0-be8e7e19c5c4",
      "name": "Append or update row in sheet5",
      "credentials": {
        "googleApi": {
          "id": "62Ae2L7a03Gf9X11",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// --- Dijkstra & Helper Functions ---\nconst mathInf = Number.POSITIVE_INFINITY;\n\nfunction buildGraph(edges) {\n  const g = {};\n  if (!edges) return g;\n  for (const e of edges) {\n    const from = e[\"from\"];\n    const to = e[\"to\"];\n    if (!g[from]) g[from] = {};\n    g[from][to] = {\n      distanceKm: Number(e[\"distanceKm\"]),\n      timeHours: Number(e[\"timeHours\"]),\n      costEUR: Number(e[\"costEUR\"]),\n    };\n  }\n  return g;\n}\n\nclass MinHeap {\n  constructor() { this.a = []; }\n  size() { return this.a.length; }\n  push(item) {\n    this.a.push(item);\n    this._siftUp(this.a.length - 1);\n  }\n  pop() {\n    if (this.a.length === 0) return null;\n    const top = this.a[0];\n    const last = this.a.pop();\n    if (this.a.length > 0) {\n      this.a[0] = last;\n      this._siftDown(0);\n    }\n    return top;\n  }\n  _siftUp(i) {\n    while (i > 0) {\n      const p = Math.floor((i - 1) / 2);\n      if (this.a[p][0] <= this.a[i][0]) break;\n      [this.a[p], this.a[i]] = [this.a[i], this.a[p]];\n      i = p;\n    }\n  }\n  _siftDown(i) {\n    const n = this.a.length;\n    while (true) {\n      let smallest = i;\n      const l = 2 * i + 1;\n      const r = 2 * i + 2;\n      if (l < n && this.a[l][0] < this.a[smallest][0]) smallest = l;\n      if (r < n && this.a[r][0] < this.a[smallest][0]) smallest = r;\n      if (smallest === i) break;\n      [this.a[i], this.a[smallest]] = [this.a[smallest], this.a[i]];\n      i = smallest;\n    }\n  }\n}\n\nfunction dijkstra(graph, origin, destination, weightKey) {\n  const pq = new MinHeap();\n  pq.push([0.0, origin, [origin]]);\n  const visited = new Set();\n  while (pq.size() > 0) {\n    const [cost, node, path] = pq.pop();\n    if (node === destination) return [cost, path];\n    if (visited.has(node)) continue;\n    visited.add(node);\n    const nbrs = graph[node] || {};\n    for (const [nxt, w] of Object.entries(nbrs)) {\n      pq.push([cost + Number(w[weightKey]), nxt, path.concat([nxt])]);\n    }\n  }\n  return [mathInf, []];\n}\n\nfunction sumAlongPath(graph, path) {\n  let dist = 0.0, time = 0.0, cost = 0.0;\n  for (let i = 0; i < path.length - 1; i++) {\n    const w = graph[path[i]][path[i+1]];\n    dist += w.distanceKm;\n    time += w.timeHours;\n    cost += w.costEUR;\n  }\n  return [dist, time, cost];\n}\n\n// --- Main n8n Logic ---\n\n// Access the merged input item\nconst input = $input.first().json;\n\n// Extract shipments and network from the merged object\nconst shipmentsList = input.shipments || [];\n// Access edges from the network data part of the merge\nconst edges = input.edges || []; \nconst graph = buildGraph(edges);\n\nconst results = shipmentsList.map(sh => {\n  const origin = sh.origin;\n  const destination = sh.destination;\n  const priority = sh.priority;\n\n  const prNorm = ((priority ?? \"low\") + \"\").toLowerCase();\n  const weightKey = (prNorm === \"express\" || prNorm === \"high\") ? \"timeHours\" : \"costEUR\";\n\n  const [totalWeight, path] = dijkstra(graph, origin, destination, weightKey);\n\n  // Initialize structure\n  let distanceKm = 0, timeHours = 0, costEUR = 0;\n  \n  if (path && path.length > 1) {\n    const totals = sumAlongPath(graph, path);\n    distanceKm = Number(totals[0].toFixed(1));\n    timeHours = Number(totals[1].toFixed(1));\n    costEUR = Number(totals[2].toFixed(1));\n  }\n\n  return {\n    shipmentId: sh.shipmentId,\n    origin,\n    destination,\n    route: path,\n    distanceKm,\n    timeHours,\n    costEUR,\n    priority,\n    logisticsNetwork: {\n      edges: path.length > 1 ? [{\n        from: origin,\n        to: destination,\n        timeHours,\n        costEUR\n      }] : []\n    },\n    batches: sh.batches || []\n  };\n});\n\nreturn {\n  json: {\n    shipments: results\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4000,
        21040
      ],
      "id": "d56ca394-6bae-4499-bf7b-4420b35f4a67",
      "name": "Dijkstra Solver"
    },
    {
      "parameters": {
        "model": "text-embedding-ada-002",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1568,
        21904
      ],
      "id": "33f5f5be-edc3-4c37-aa87-379ce033b70e",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "p0NABpxvv7SHkRbU",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "dataType": "binary",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        -1008,
        21840
      ],
      "id": "f49bb5a1-c297-48e6-8239-a9ef289c07f3",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "mode": "insert",
        "memoryKey": {
          "__rl": true,
          "value": "vector_store_key",
          "mode": "list",
          "cachedResultName": "vector_store_key"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
      "typeVersion": 1.2,
      "position": [
        -4960,
        21424
      ],
      "id": "32587b3e-a372-46ad-9ac3-a8dbcac78ade",
      "name": "Insert Data to Store"
    },
    {
      "parameters": {
        "content": "### consult RAG for port information\n",
        "height": 752,
        "width": 736,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1600,
        21472
      ],
      "typeVersion": 1,
      "id": "9832d763-511f-4225-b49c-857f87444026",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "content": "## How does it work?\ninput document in â€œUpload your file hereâ€, and run â€œInsert Data to storeâ€. The route compliance agent will call the query data tool itself when it is run. Prompt to the agent to use the tool.",
        "height": 128,
        "width": 416
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1296,
        22064
      ],
      "id": "d5626a7f-efe1-444c-8b51-c1f6b8ac0147",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "https://drive.google.com/file/d/1vHemKJQqziuTmTIPts_c9YuWVMe-AEvB/view?usp=share_link",
          "mode": "url"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -5120,
        21424
      ],
      "id": "5b841f59-9b0f-4ceb-916c-12b94ead3350",
      "name": "Download file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "wlp5e7Sd2PSIEcKp",
          "name": "Google Drive account Lisa"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "knowledge_base",
        "toolDescription": "Use this tool to retrieve authoritative EU port, maritime, and transport\nregulatory information. This tool MUST be used whenever port operations,\nport access, routing constraints, or compliance considerations are assessed.\n",
        "memoryKey": {
          "__rl": true,
          "mode": "list",
          "value": "vector_store_key"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
      "typeVersion": 1.2,
      "position": [
        -1568,
        21552
      ],
      "id": "42c48650-e397-47d8-99b4-2d2f73ebb26a",
      "name": "Route_Knowledge"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5-nano",
          "mode": "list",
          "cachedResultName": "gpt-5-nano"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -1472,
        21264
      ],
      "id": "91e31915-dff8-4ca2-9835-dd0c054513b2",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "p0NABpxvv7SHkRbU",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5-nano",
          "mode": "list",
          "cachedResultName": "gpt-5-nano"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -1344,
        20832
      ],
      "id": "4283248f-f299-4a98-8ce2-54b235d17b05",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "p0NABpxvv7SHkRbU",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-ada-002",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1616,
        20352
      ],
      "id": "885102cb-8c7b-4d5f-aa7b-9747189cf041",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "p0NABpxvv7SHkRbU",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "dataType": "binary",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        -1088,
        20336
      ],
      "id": "678d0298-55a6-4d11-a591-2553a16b1389",
      "name": "Default Data Loader1"
    },
    {
      "parameters": {
        "mode": "insert",
        "memoryKey": {
          "__rl": true,
          "value": "vector_store_key",
          "mode": "list",
          "cachedResultName": "vector_store_key"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
      "typeVersion": 1.2,
      "position": [
        -5008,
        20656
      ],
      "id": "19f1629c-2cee-4e55-bc2d-906a2ac45b84",
      "name": "Insert Data to Store1"
    },
    {
      "parameters": {
        "content": "### consult RAG for textiles EU legislation document\n",
        "height": 464,
        "width": 736,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1680,
        20048
      ],
      "typeVersion": 1,
      "id": "f8f5c796-2e14-4706-af2b-353add3abf9d",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "https://drive.google.com/file/d/10tYRxUjXiQIGTW9ic-zoYNtqudSjFTEZ/view?usp=sharing",
          "mode": "url"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -5184,
        20656
      ],
      "id": "7f0ebd3c-25bc-45aa-a6f0-78a9cd05df38",
      "name": "Download file1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "wlp5e7Sd2PSIEcKp",
          "name": "Google Drive account Lisa"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "textiles_strategy_knowledge",
        "toolDescription": "Use this tool to retrieve data on textiles strategy for Sustainable and Circular Textiles from the European Comission.",
        "memoryKey": {
          "__rl": true,
          "mode": "list",
          "value": "vector_store_key"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
      "typeVersion": 1.2,
      "position": [
        -1424,
        20336
      ],
      "id": "14cd70ad-dc8f-4e67-b05f-000e77aef4e9",
      "name": "DPP_knowledge"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"shipments\": [\n    {\n      \"shipmentId\": \"SHIP-001\",\n      \"origin\": \"Valencia\",\n      \"destination\": \"Bremerhaven\",\n      \"priority\": \"Medium\",\n      \"batches\": [\n        {\n          \"batchId\": \"BAT-SHIP-001-001\",\n          \"shipmentId\": \"SHIP-001\",\n          \"timestamp\": \"2025-12-14T14:43:35.221921\",\n          \"orders\": [\n            {\n              \"id\": \"ORD-BAT-SHIP-001-001-001\",\n              \"batchId\": \"BAT-SHIP-001-001\",\n              \"brand\": \"Casual Comfort\",\n              \"quantity\": 2,\n              \"garments\": [\n                {\n                  \"id\": \"GAR-001\",\n                  \"orderId\": \"ORD-BAT-SHIP-001-001-001\",\n                  \"dpp\": {\n                    \"$schema\": \"https://schemas.dppmcp.com/textiles/garment.json\",\n                    \"dppMetadata\": {\n                      \"passportIdentifier\": \"https://id.gs1.org/01/09506000134039\",\n                      \"passportVersion\": \"1.0.0\",\n                      \"issuedDate\": \"2026-01-22\",\n                      \"garmentId\": \"GAR-001\",\n                      \"orderId\": \"ORD-BAT-SHIP-001-001-001\"\n                    },\n                    \"productIdentification\": {\n                      \"productName\": \"Cotton T-Shirt\",\n                      \"productCategory\": \"textiles\",\n                      \"productType\": \"garment\"\n                    },\n                    \"manufacturer\": {\n                      \"name\": \"Green Threads Ltd\",\n                      \"country\": \"GB\"\n                    },\n                    \"rawMaterialsAndProcess\": {\n                      \"materials\": [\n                        {\n                          \"materialType\": \"organic_cotton\",\n                          \"percentage\": 100,\n                          \"certified\": true,\n                          \"certification\": \"GOTS\"\n                        }\n                      ],\n                      \"sourceCountry\": \"IT\",\n                      \"harvestDate\": \"2025-09-09\"\n                    },\n                    \"distribution\": {\n                      \"warehouseLocation\": \"Bremerhaven\",\n                      \"packagingType\": \"biodegradable\",\n                      \"storageConditions\": \"standard\"\n                    }\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        {\n          \"batchId\": \"BAT-SHIP-001-002\",\n          \"shipmentId\": \"SHIP-001\",\n          \"timestamp\": \"2025-12-14T16:43:35.221921\",\n          \"orders\": [\n            {\n              \"id\": \"ORD-BAT-SHIP-001-002-001\",\n              \"batchId\": \"BAT-SHIP-001-002\",\n              \"brand\": \"EcoWear Ltd\",\n              \"quantity\": 1,\n              \"garments\": [\n                {\n                  \"id\": \"GAR-002\",\n                  \"orderId\": \"ORD-BAT-SHIP-001-002-001\",\n                  \"dpp\": {\n                    \"$schema\": \"https://schemas.dppmcp.com/textiles/garment.json\",\n                    \"dppMetadata\": {\n                      \"passportIdentifier\": \"https://id.gs1.org/01/09506000135827\",\n                      \"passportVersion\": \"1.0.0\",\n                      \"issuedDate\": \"2026-01-22\",\n                      \"garmentId\": \"GAR-002\",\n                      \"orderId\": \"ORD-BAT-SHIP-001-002-001\"\n                    },\n                    \"productIdentification\": {\n                      \"productName\": \"Wool Sweater\",\n                      \"productCategory\": \"textiles\",\n                      \"productType\": \"garment\"\n                    },\n                    \"manufacturer\": {\n                      \"name\": \"Sustainable Wear BV\",\n                      \"country\": \"NL\"\n                    },\n                    \"rawMaterialsAndProcess\": {\n                      \"materials\": [\n                        {\n                          \"materialType\": \"wool\",\n                          \"percentage\": 100,\n                          \"certified\": true,\n                          \"certification\": \"OEKO-TEX\"\n                        }\n                      ],\n                      \"sourceCountry\": \"DE\",\n                      \"harvestDate\": \"2025-08-20\"\n                    },\n                    \"distribution\": {\n                      \"warehouseLocation\": \"Bremerhaven\",\n                      \"packagingType\": \"recyclable\",\n                      \"storageConditions\": \"standard\"\n                    }\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        {\n          \"batchId\": \"BAT-SHIP-001-003\",\n          \"shipmentId\": \"SHIP-001\",\n          \"timestamp\": \"2025-12-14T18:43:35.221921\",\n          \"orders\": [\n            {\n              \"id\": \"ORD-BAT-SHIP-001-003-001\",\n              \"batchId\": \"BAT-SHIP-001-003\",\n              \"brand\": \"Nordic Fashion\",\n              \"quantity\": 1,\n              \"garments\": [\n                {\n                  \"id\": \"GAR-003\",\n                  \"orderId\": \"ORD-BAT-SHIP-001-003-001\",\n                  \"dpp\": {\n                    \"$schema\": \"https://schemas.dppmcp.com/textiles/garment.json\",\n                    \"dppMetadata\": {\n                      \"passportIdentifier\": \"https://id.gs1.org/01/09506000132852\",\n                      \"passportVersion\": \"1.0.0\",\n                      \"issuedDate\": \"2026-01-22\",\n                      \"garmentId\": \"GAR-003\",\n                      \"orderId\": \"ORD-BAT-SHIP-001-003-001\"\n                    },\n                    \"productIdentification\": {\n                      \"productName\": \"Linen Blouse\",\n                      \"productCategory\": \"textiles\",\n                      \"productType\": \"garment\"\n                    },\n                    \"manufacturer\": {\n                      \"name\": \"Nordic Fashion AB\",\n                      \"country\": \"SE\"\n                    },\n                    \"rawMaterialsAndProcess\": {\n                      \"materials\": [\n                        {\n                          \"materialType\": \"linen\",\n                          \"percentage\": 100,\n                          \"certified\": true,\n                          \"certification\": \"OEKO-TEX\"\n                        }\n                      ],\n                      \"sourceCountry\": \"PT\",\n                      \"harvestDate\": \"2025-08-05\"\n                    },\n                    \"distribution\": {\n                      \"warehouseLocation\": \"Bremerhaven\",\n                      \"packagingType\": \"reusable\",\n                      \"storageConditions\": \"standard\"\n                    }\n                  }\n                }\n              ]\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4384,
        20864
      ],
      "id": "48c5ab0a-a95b-479f-988c-8f79133c513e",
      "name": "CompliantData"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"shipments\": [\n    {\n      \"shipmentId\": \"SHIP-001\",\n      \"origin\": \"Valencia\",\n      \"destination\": \"Bremerhaven\",\n      \"priority\": \"Medium\",\n      \"batches\": [\n        {\n          \"batchId\": \"BAT-SHIP-001-001\",\n          \"shipmentId\": \"SHIP-001\",\n          \"timestamp\": \"2025-12-14T14:43:35.221921\",\n          \"orders\": [\n            {\n              \"id\": \"ORD-BAT-SHIP-001-001-001\",\n              \"batchId\": \"BAT-SHIP-001-001\",\n              \"brand\": \"Casual Comfort\",\n              \"quantity\": 1,\n              \"garments\": [\n                {\n                  \"id\": \"GAR-101\",\n                  \"orderId\": \"ORD-BAT-SHIP-001-001-001\",\n                  \"dpp\": {\n                    \"$schema\": \"https://schemas.dppmcp.com/textiles/garment.json\",\n                    \"dppMetadata\": {\n                      \"passportIdentifier\": \"https://id.gs1.org/01/09506000134039\",\n                      \"passportVersion\": \"1.0.0\",\n                      \"issuedDate\": \"2026-01-22\",\n                      \"garmentId\": \"GAR-101\",\n                      \"orderId\": \"ORD-BAT-SHIP-001-001-001\"\n                    },\n                    \"productIdentification\": {\n                      \"productName\": \"Cotton T-Shirt\",\n                      \"productCategory\": \"textiles\",\n                      \"productType\": \"garment\"\n                    },\n                    \"manufacturer\": {\n                      \"name\": \"Green Threads Ltd\",\n                      \"country\": \"GB\"\n                    },\n                    \"rawMaterialsAndProcess\": {\n                      \"materials\": [\n                        {\n                          \"materialType\": \"cotton\",\n                          \"percentage\": 85,\n                          \"certified\": false,\n                          \"certification\": \"GOTS\"\n                        },\n                        {\n                          \"materialType\": \"azo_dyes\",\n                          \"percentage\": 5,\n                          \"certified\": false,\n                          \"certification\": null\n                        }\n                      ],\n                      \"chemicalTreatments\": [\n                        \"azo_dyes\",\n                        \"formaldehyde_resin\"\n                      ],\n                      \"sourceCountry\": \"CN\",\n                      \"harvestDate\": \"2025-09-09\"\n                    },\n                    \"distribution\": {\n                      \"warehouseLocation\": \"Bremerhaven\",\n                      \"packagingType\": \"biodegradable\",\n                      \"storageConditions\": \"standard\"\n                    }\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        {\n          \"batchId\": \"BAT-SHIP-001-002\",\n          \"shipmentId\": \"SHIP-001\",\n          \"timestamp\": \"2025-12-14T16:43:35.221921\",\n          \"orders\": [\n            {\n              \"id\": \"ORD-BAT-SHIP-001-002-001\",\n              \"batchId\": \"BAT-SHIP-001-002\",\n              \"brand\": \"EcoWear Ltd\",\n              \"quantity\": 1,\n              \"garments\": [\n                {\n                  \"id\": \"GAR-002\",\n                  \"orderId\": \"ORD-BAT-SHIP-001-002-001\",\n                  \"dpp\": {\n                    \"$schema\": \"https://schemas.dppmcp.com/textiles/garment.json\",\n                    \"dppMetadata\": {\n                      \"passportIdentifier\": \"https://id.gs1.org/01/09506000135827\",\n                      \"passportVersion\": \"1.0.0\",\n                      \"issuedDate\": \"2026-01-22\",\n                      \"garmentId\": \"GAR-002\",\n                      \"orderId\": \"ORD-BAT-SHIP-001-002-001\"\n                    },\n                    \"productIdentification\": {\n                      \"productName\": \"Wool Sweater\",\n                      \"productCategory\": \"textiles\",\n                      \"productType\": \"garment\"\n                    },\n                    \"manufacturer\": {\n                      \"name\": \"Sustainable Wear BV\",\n                      \"country\": \"NL\"\n                    },\n                    \"rawMaterialsAndProcess\": {\n                      \"materials\": [\n                        {\n                          \"materialType\": \"wool\",\n                          \"percentage\": 100,\n                          \"certified\": true,\n                          \"certification\": \"OEKO-TEX\"\n                        }\n                      ],\n                      \"sourceCountry\": \"DE\",\n                      \"harvestDate\": \"2025-08-20\"\n                    },\n                    \"distribution\": {\n                      \"warehouseLocation\": \"Bremerhaven\",\n                      \"packagingType\": \"recyclable\",\n                      \"storageConditions\": \"standard\"\n                    }\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        {\n          \"batchId\": \"BAT-SHIP-001-003\",\n          \"shipmentId\": \"SHIP-001\",\n          \"timestamp\": \"2025-12-14T18:43:35.221921\",\n          \"orders\": [\n            {\n              \"id\": \"ORD-BAT-SHIP-001-003-001\",\n              \"batchId\": \"BAT-SHIP-001-003\",\n              \"brand\": \"Urban Style\",\n              \"quantity\": 1,\n              \"garments\": [\n                {\n                  \"id\": \"GAR-103\",\n                  \"orderId\": \"ORD-BAT-SHIP-001-003-001\",\n                  \"dpp\": {\n                    \"$schema\": \"https://schemas.dppmcp.com/textiles/garment.json\",\n                    \"dppMetadata\": {\n                      \"passportIdentifier\": \"https://id.gs1.org/01/09506000132852\",\n                      \"passportVersion\": \"1.0.0\",\n                      \"issuedDate\": \"2026-01-22\",\n                      \"garmentId\": \"GAR-103\",\n                      \"orderId\": \"ORD-BAT-SHIP-001-003-001\"\n                    },\n                    \"productIdentification\": {\n                      \"productName\": \"Waterproof Jacket\",\n                      \"productCategory\": \"textiles\",\n                      \"productType\": \"garment\"\n                    },\n                    \"manufacturer\": {\n                      \"name\": \"Urban Style GmbH\",\n                      \"country\": \"DE\"\n                    },\n                    \"rawMaterialsAndProcess\": {\n                      \"materials\": [\n                        {\n                          \"materialType\": \"polyester\",\n                          \"percentage\": 70,\n                          \"certified\": false,\n                          \"certification\": null\n                        },\n                        {\n                          \"materialType\": \"polyvinyl_chloride\",\n                          \"percentage\": 20,\n                          \"certified\": false,\n                          \"certification\": null\n                        }\n                      ],\n                      \"chemicalTreatments\": [\n                        \"PFAS_water_repellent\",\n                        \"phthalates\",\n                        \"antimony_trioxide\"\n                      ],\n                      \"sourceCountry\": \"BD\",\n                      \"harvestDate\": \"2025-09-02\"\n                    },\n                    \"distribution\": {\n                      \"warehouseLocation\": \"Bremerhaven\",\n                      \"packagingType\": \"plastic\",\n                      \"storageConditions\": \"standard\"\n                    }\n                  }\n                }\n              ]\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4368,
        20704
      ],
      "id": "450eb68d-408c-46a1-8a38-9895075441a3",
      "name": "NonCompliantData"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"isFlagged\": true,\n  \"reason\": \"does not contain all required DPP information\",\n  \"includedBatches\": \"BatchId x\",\n  \"severity\": \"0.8\",\n  \"recommendations\": \"based on x, you should commit action y\"\n}\n"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -1168,
        20832
      ],
      "id": "6888db83-382e-47b0-b4b9-4ab8fe96bfaf",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"isFlagged\": true,\n  \"reason\": \"severe weather conditions\",\n  \"includedCities\": \"City x\",\n  \"severity\": \"0.8\",\n  \"recommendations\": \"based on x, you should commit action y\"\n}\n"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -1168,
        21312
      ],
      "id": "1729e7e3-aad5-43f1-840f-233e7459796b",
      "name": "Structured Output Parser1"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"batchId\": \"BAT-SHIP-001-001\",\n  \"shipmentId\": \"SHIP-001\",\n  \"origin\": \"Valencia\",\n  \"destination\": \"Bremerhaven\",\n  \"garments\": [\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-001\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-001-001\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000134039\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"hemp\",\n              \"percentage\": 100,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-10-21\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-001\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-001-002\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000138126\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"recycled_polyester\",\n              \"percentage\": 80,\n              \"certified\": true,\n              \"certification\": \"BCI\"\n            },\n            {\n              \"materialType\": \"hemp\",\n              \"percentage\": 20,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-09-09\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-002\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-002-001\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000137984\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"wool\",\n              \"percentage\": 100,\n              \"certified\": true,\n              \"certification\": \"BCI\"\n            }\n          ],\n          \"harvestDate\": \"2025-10-23\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-002\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-002-002\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000139374\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"recycled_polyester\",\n              \"percentage\": 80,\n              \"certified\": true,\n              \"certification\": \"BCI\"\n            },\n            {\n              \"materialType\": \"cotton\",\n              \"percentage\": 20,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-08-30\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-003\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-003-002\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000133616\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"bamboo\",\n              \"percentage\": 70,\n              \"certified\": true,\n              \"certification\": \"GOTS\"\n            },\n            {\n              \"materialType\": \"hemp\",\n              \"percentage\": 30,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-09-09\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-005\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-005-002\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000133743\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"bamboo\",\n              \"percentage\": 95,\n              \"certified\": true,\n              \"certification\": \"BCI\"\n            },\n            {\n              \"materialType\": \"hemp\",\n              \"percentage\": 5,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-08-15\"\n        }\n      }\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1392,
        19808
      ],
      "id": "d8855e4a-d078-401b-b2e9-8de7147ea5da",
      "name": "clean_batch",
      "disabled": true
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"batchId\": \"BAT-SHIP-001-001\",\n  \"shipmentId\": \"SHIP-001\",\n  \"origin\": \"Valencia\",\n  \"destination\": \"Bremerhaven\",\n  \"garments\": [\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-001\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-001-001\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000134039\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"hemp\",\n              \"percentage\": 100,\n              \"certified\": false,\n              \"certification\": \"GOTS\"\n            }\n          ],\n          \"harvestDate\": \"2025-10-21\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-001\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-001-002\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000138126\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"recycled_polyester\",\n              \"percentage\": 80,\n              \"certified\": true,\n              \"certification\": \"BCI\"\n            },\n            {\n              \"materialType\": \"hemp\",\n              \"percentage\": 20,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-09-09\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-002\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-002-001\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000137984\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"wool\",\n              \"percentage\": 100,\n              \"certified\": true,\n              \"certification\": \"BCI\"\n            }\n          ],\n          \"harvestDate\": \"2025-10-23\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-002\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-002-002\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000139374\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"recycled_polyester\",\n              \"percentage\": 80,\n              \"certified\": true,\n              \"certification\": \"BCI\"\n            },\n            {\n              \"materialType\": \"cotton\",\n              \"percentage\": 20,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-08-30\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-003\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-003-002\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000133616\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"bamboo\",\n              \"percentage\": 70,\n              \"certified\": true,\n              \"certification\": \"GOTS\"\n            },\n            {\n              \"materialType\": \"hemp\",\n              \"percentage\": 30,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-09-09\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-005\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-005-002\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000133743\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"bamboo\",\n              \"percentage\": 95,\n              \"certified\": true,\n              \"certification\": \"BCI\"\n            },\n            {\n              \"materialType\": \"hemp\",\n              \"percentage\": 5,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-08-15\"\n        }\n      }\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1184,
        19808
      ],
      "id": "c97f7f8e-d0dd-4823-94e7-866131829c32",
      "name": "batch_cert_error",
      "disabled": true
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"batchId\": \"BAT-SHIP-001-001\",\n  \"shipmentId\": \"SHIP-001\",\n  \"origin\": \"Valencia\",\n  \"destination\": \"Bremerhaven\",\n  \"garments\": [\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-001\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-001-001\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000134039\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"hemp\",\n              \"percentage\": 90,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-10-21\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-001\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-001-002\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000138126\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"recycled_polyester\",\n              \"percentage\": 80,\n              \"certified\": true,\n              \"certification\": \"BCI\"\n            },\n            {\n              \"materialType\": \"hemp\",\n              \"percentage\": 20,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-09-09\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-002\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-002-001\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000137984\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"wool\",\n              \"percentage\": 100,\n              \"certified\": true,\n              \"certification\": \"BCI\"\n            }\n          ],\n          \"harvestDate\": \"2025-10-23\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-002\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-002-002\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000139374\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"recycled_polyester\",\n              \"percentage\": 80,\n              \"certified\": true,\n              \"certification\": \"BCI\"\n            },\n            {\n              \"materialType\": \"cotton\",\n              \"percentage\": 20,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-08-30\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-003\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-003-002\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000133616\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"bamboo\",\n              \"percentage\": 70,\n              \"certified\": true,\n              \"certification\": \"GOTS\"\n            },\n            {\n              \"materialType\": \"hemp\",\n              \"percentage\": 30,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-09-09\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-005\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-005-002\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000133743\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"bamboo\",\n              \"percentage\": 95,\n              \"certified\": true,\n              \"certification\": \"BCI\"\n            },\n            {\n              \"materialType\": \"hemp\",\n              \"percentage\": 5,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-08-15\"\n        }\n      }\n    }\n  ]\n}\n\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -976,
        19808
      ],
      "id": "274a63df-8fd4-414a-a8ab-d4efbe25d869",
      "name": "batch_percentage_error",
      "disabled": true
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"batchId\": \"BAT-SHIP-001-001\",\n  \"shipmentId\": \"SHIP-001\",\n  \"origin\": \"Valencia\",\n  \"destination\": \"Bremerhaven\",\n  \"garments\": [\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-001\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-001-001\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000134039\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"hemp\",\n              \"percentage\": 80,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-10-21\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-001\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-001-002\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000138126\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"recycled_polyester\",\n              \"percentage\": 80,\n              \"certified\": true,\n              \"certification\": null\n            },\n            {\n              \"materialType\": \"hemp\",\n              \"percentage\": 20,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-09-09\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-002\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-002-001\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000137984\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"wool\",\n              \"percentage\": 100,\n              \"certified\": true,\n              \"certification\": \"BCI\"\n            }\n          ],\n          \"harvestDate\": \"2025-10-23\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-002\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-002-002\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000139374\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"recycled_polyester\",\n              \"percentage\": 80,\n              \"certified\": true,\n              \"certification\": \"BCI\"\n            },\n            {\n              \"materialType\": \"cotton\",\n              \"percentage\": 20,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-08-30\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-003\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-003-002\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000133616\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"bamboo\",\n              \"percentage\": 70,\n              \"certified\": true,\n              \"certification\": \"GOTS\"\n            },\n            {\n              \"materialType\": \"hemp\",\n              \"percentage\": 30,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-09-09\"\n        }\n      }\n    },\n    {\n      \"orderId\": \"ORD-BAT-SHIP-001-001-005\",\n      \"garmentId\": \"GAR-ORD-BAT-SHIP-001-001-005-002\",\n      \"dpp\": {\n        \"dppMetadata\": {\n          \"passportIdentifier\": \"https://id.gs1.org/01/09506000133743\",\n          \"issuedDate\": \"2026-01-22\"\n        },\n        \"rawMaterialsAndProcess\": {\n          \"materials\": [\n            {\n              \"materialType\": \"bamboo\",\n              \"percentage\": 95,\n              \"certified\": true,\n              \"certification\": \"BCI\"\n            },\n            {\n              \"materialType\": \"hemp\",\n              \"percentage\": 5,\n              \"certified\": false,\n              \"certification\": null\n            }\n          ],\n          \"harvestDate\": \"2025-08-15\"\n        }\n      }\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -768,
        19808
      ],
      "id": "2ae9e9dd-513e-4238-b041-4793d97ee798",
      "name": "batch_multiple_errors",
      "disabled": true
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"decision\": \"PROCEED | DELAY | BLOCK\",\n  \"isFlagged\": true,\n  \"reason\": \"\",\n  \"includedBatches\": \"\",\n  \"includedCities\": \"\",\n  \"severity\": \"\",\n  \"recommendations\": \"\"\n}\n"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -112,
        21104
      ],
      "id": "3100881f-7db7-4589-8ca9-6bfa684eb010",
      "name": "Structured Output Parser2"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"schemaVersion\": \"1.0\",\n  \"description\": \"Synthetic logistics network edges (distance/time/cost) derived from city legs found in data.json routes and origin-destination pairs.\",\n  \"nodes\": [\n    {\n      \"city\": \"Algeciras\",\n      \"latitude\": 36.1408,\n      \"longitude\": -5.4562\n    },\n    {\n      \"city\": \"antwerp\",\n      \"latitude\": 51.2213,\n      \"longitude\": 4.4051\n    },\n    {\n      \"city\": \"Barcelona\",\n      \"latitude\": 41.3894,\n      \"longitude\": 2.1686\n    },\n    {\n      \"city\": \"Bremerhaven\",\n      \"latitude\": 53.5396,\n      \"longitude\": 8.5809\n    },\n    {\n      \"city\": \"Dunkirk\",\n      \"latitude\": 51.0344,\n      \"longitude\": 2.377\n    },\n    {\n      \"city\": \"Felixstowe\",\n      \"latitude\": 51.9636,\n      \"longitude\": 1.351\n    },\n    {\n      \"city\": \"Genoa\",\n      \"latitude\": 44.4056,\n      \"longitude\": 8.9463\n    },\n    {\n      \"city\": \"Gioia Tauro\",\n      \"latitude\": 38.4247,\n      \"longitude\": 15.901\n    },\n    {\n      \"city\": \"Hamburg\",\n      \"latitude\": 53.5461,\n      \"longitude\": 9.9661\n    },\n    {\n      \"city\": \"Le Havre\",\n      \"latitude\": 49.4939,\n      \"longitude\": 0.1079\n    },\n    {\n      \"city\": \"Marseille\",\n      \"latitude\": 43.2965,\n      \"longitude\": 5.3698\n    },\n    {\n      \"city\": \"Piraeus\",\n      \"latitude\": 37.9429,\n      \"longitude\": 23.6469\n    },\n    {\n      \"city\": \"Rotterdam\",\n      \"latitude\": 51.9496,\n      \"longitude\": 4.1383\n    },\n    {\n      \"city\": \"Valencia\",\n      \"latitude\": 39.4699,\n      \"longitude\": -0.3763\n    }\n  ],\n  \"edges\": [\n    {\n      \"from\": \"Algeciras\",\n      \"to\": \"antwerp\",\n      \"distanceKm\": 679.4,\n      \"timeHours\": 17.99,\n      \"costEUR\": 636.79,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Algeciras\",\n      \"to\": \"Valencia\",\n      \"distanceKm\": 2109.3,\n      \"timeHours\": 48.23,\n      \"costEUR\": 1691.87,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"antwerp\",\n      \"to\": \"Barcelona\",\n      \"distanceKm\": 2592.8,\n      \"timeHours\": 62.67,\n      \"costEUR\": 2301.46,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"antwerp\",\n      \"to\": \"Bremerhaven\",\n      \"distanceKm\": 406.8,\n      \"timeHours\": 7.28,\n      \"costEUR\": 403.61,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"antwerp\",\n      \"to\": \"Genoa\",\n      \"distanceKm\": 526.9,\n      \"timeHours\": 8.21,\n      \"costEUR\": 538.82,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"antwerp\",\n      \"to\": \"Hamburg\",\n      \"distanceKm\": 1889.1,\n      \"timeHours\": 30.15,\n      \"costEUR\": 1571.0,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"antwerp\",\n      \"to\": \"Piraeus\",\n      \"distanceKm\": 1437.0,\n      \"timeHours\": 34.96,\n      \"costEUR\": 1297.2,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"antwerp\",\n      \"to\": \"Rotterdam\",\n      \"distanceKm\": 1255.9,\n      \"timeHours\": 28.15,\n      \"costEUR\": 1387.65,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Barcelona\",\n      \"to\": \"antwerp\",\n      \"distanceKm\": 607.2,\n      \"timeHours\": 11.68,\n      \"costEUR\": 562.06,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Barcelona\",\n      \"to\": \"Hamburg\",\n      \"distanceKm\": 1984.0,\n      \"timeHours\": 43.86,\n      \"costEUR\": 1351.02,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"Barcelona\",\n      \"to\": \"Valencia\",\n      \"distanceKm\": 2531.3,\n      \"timeHours\": 42.91,\n      \"costEUR\": 2247.6,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"Dunkirk\",\n      \"to\": \"Bremerhaven\",\n      \"distanceKm\": 253.9,\n      \"timeHours\": 5.37,\n      \"costEUR\": 298.46,\n      \"mode\": \"road\"\n    },\n    {\n      \"from\": \"Dunkirk\",\n      \"to\": \"Le Havre\",\n      \"distanceKm\": 1955.0,\n      \"timeHours\": 36.16,\n      \"costEUR\": 1327.8,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Dunkirk\",\n      \"to\": \"Marseille\",\n      \"distanceKm\": 1308.9,\n      \"timeHours\": 24.39,\n      \"costEUR\": 967.3,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Felixstowe\",\n      \"to\": \"Gioia Tauro\",\n      \"distanceKm\": 1932.5,\n      \"timeHours\": 32.52,\n      \"costEUR\": 1707.46,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Felixstowe\",\n      \"to\": \"Le Havre\",\n      \"distanceKm\": 1613.9,\n      \"timeHours\": 30.4,\n      \"costEUR\": 1634.11,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Genoa\",\n      \"to\": \"Barcelona\",\n      \"distanceKm\": 1559.1,\n      \"timeHours\": 38.93,\n      \"costEUR\": 1042.59,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Genoa\",\n      \"to\": \"Hamburg\",\n      \"distanceKm\": 1388.4,\n      \"timeHours\": 22.65,\n      \"costEUR\": 760.62,\n      \"mode\": \"road\"\n    },\n    {\n      \"from\": \"Genoa\",\n      \"to\": \"Le Havre\",\n      \"distanceKm\": 791.0,\n      \"timeHours\": 14.67,\n      \"costEUR\": 606.34,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Genoa\",\n      \"to\": \"Rotterdam\",\n      \"distanceKm\": 2430.3,\n      \"timeHours\": 60.12,\n      \"costEUR\": 2137.76,\n      \"mode\": \"road\"\n    },\n    {\n      \"from\": \"Genoa\",\n      \"to\": \"Valencia\",\n      \"distanceKm\": 1274.5,\n      \"timeHours\": 27.24,\n      \"costEUR\": 937.5,\n      \"mode\": \"road\"\n    },\n    {\n      \"from\": \"Hamburg\",\n      \"to\": \"Dunkirk\",\n      \"distanceKm\": 2148.4,\n      \"timeHours\": 41.02,\n      \"costEUR\": 1946.15,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"Hamburg\",\n      \"to\": \"Felixstowe\",\n      \"distanceKm\": 373.7,\n      \"timeHours\": 8.88,\n      \"costEUR\": 544.34,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"Hamburg\",\n      \"to\": \"Valencia\",\n      \"distanceKm\": 562.2,\n      \"timeHours\": 8.69,\n      \"costEUR\": 640.78,\n      \"mode\": \"road\"\n    },\n    {\n      \"from\": \"Le Havre\",\n      \"to\": \"Barcelona\",\n      \"distanceKm\": 2303.0,\n      \"timeHours\": 39.78,\n      \"costEUR\": 2093.66,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Le Havre\",\n      \"to\": \"Felixstowe\",\n      \"distanceKm\": 2201.8,\n      \"timeHours\": 46.02,\n      \"costEUR\": 1517.92,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Le Havre\",\n      \"to\": \"Marseille\",\n      \"distanceKm\": 2034.7,\n      \"timeHours\": 46.96,\n      \"costEUR\": 1653.6,\n      \"mode\": \"road\"\n    },\n    {\n      \"from\": \"Le Havre\",\n      \"to\": \"Rotterdam\",\n      \"distanceKm\": 1722.6,\n      \"timeHours\": 28.48,\n      \"costEUR\": 1351.26,\n      \"mode\": \"road\"\n    },\n    {\n      \"from\": \"Le Havre\",\n      \"to\": \"Valencia\",\n      \"distanceKm\": 2294.2,\n      \"timeHours\": 63.12,\n      \"costEUR\": 2315.92,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Marseille\",\n      \"to\": \"Bremerhaven\",\n      \"distanceKm\": 491.2,\n      \"timeHours\": 11.02,\n      \"costEUR\": 483.11,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Marseille\",\n      \"to\": \"Le Havre\",\n      \"distanceKm\": 1526.7,\n      \"timeHours\": 25.34,\n      \"costEUR\": 1502.83,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Piraeus\",\n      \"to\": \"Genoa\",\n      \"distanceKm\": 781.5,\n      \"timeHours\": 12.04,\n      \"costEUR\": 698.82,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"Piraeus\",\n      \"to\": \"Le Havre\",\n      \"distanceKm\": 1818.6,\n      \"timeHours\": 28.19,\n      \"costEUR\": 1650.91,\n      \"mode\": \"rail\"\n    },\n    {\n      \"from\": \"Rotterdam\",\n      \"to\": \"Algeciras\",\n      \"distanceKm\": 810.4,\n      \"timeHours\": 18.39,\n      \"costEUR\": 762.08,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Rotterdam\",\n      \"to\": \"antwerp\",\n      \"distanceKm\": 2150.6,\n      \"timeHours\": 34.99,\n      \"costEUR\": 1674.56,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Rotterdam\",\n      \"to\": \"Barcelona\",\n      \"distanceKm\": 1834.9,\n      \"timeHours\": 30.6,\n      \"costEUR\": 1002.13,\n      \"mode\": \"road\"\n    },\n    {\n      \"from\": \"Rotterdam\",\n      \"to\": \"Genoa\",\n      \"distanceKm\": 1503.3,\n      \"timeHours\": 32.24,\n      \"costEUR\": 1547.47,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Rotterdam\",\n      \"to\": \"Gioia Tauro\",\n      \"distanceKm\": 934.2,\n      \"timeHours\": 19.87,\n      \"costEUR\": 634.86,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Rotterdam\",\n      \"to\": \"Hamburg\",\n      \"distanceKm\": 2245.2,\n      \"timeHours\": 42.25,\n      \"costEUR\": 2046.29,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Valencia\",\n      \"to\": \"Algeciras\",\n      \"distanceKm\": 763.0,\n      \"timeHours\": 12.29,\n      \"costEUR\": 496.91,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Valencia\",\n      \"to\": \"Barcelona\",\n      \"distanceKm\": 2149.8,\n      \"timeHours\": 48.65,\n      \"costEUR\": 1788.85,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Valencia\",\n      \"to\": \"Dunkirk\",\n      \"distanceKm\": 1881.8,\n      \"timeHours\": 33.63,\n      \"costEUR\": 1428.85,\n      \"mode\": \"multimodal\"\n    },\n    {\n      \"from\": \"Valencia\",\n      \"to\": \"Genoa\",\n      \"distanceKm\": 2080.9,\n      \"timeHours\": 40.98,\n      \"costEUR\": 1924.31,\n      \"mode\": \"sea\"\n    },\n    {\n      \"from\": \"Valencia\",\n      \"to\": \"Piraeus\",\n      \"distanceKm\": 1213.6,\n      \"timeHours\": 19.91,\n      \"costEUR\": 812.96,\n      \"mode\": \"multimodal\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2832,
        21104
      ],
      "id": "72d8c7e2-0e0c-44ee-bef9-dfa5da16e65e",
      "name": "Logistics Network1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "0fefcc3e-9b08-4d81-9312-cd255b232d32",
              "leftValue": "={{ $json.metadata.pdf.version }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -4656,
        20656
      ],
      "id": "1b8f7d1d-1a58-44cb-b063-a44967f61dab",
      "name": "If1",
      "executeOnce": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "6dcba3a4-8025-4e98-b6e9-7100fed11097",
              "leftValue": "={{ $json.metadata.pdf.info.Producer }}",
              "rightValue": 0,
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -4608,
        21424
      ],
      "id": "4ad88072-15d9-41ca-8569-8b0d0aaf6d15",
      "name": "If2",
      "executeOnce": true
    }
  ],
  "pinData": {},
  "connections": {
    "batch compliance agent": {
      "main": [
        [
          {
            "node": "Append or update row in sheet4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Complete": {
      "main": [
        [
          {
            "node": "Batch mapping",
            "type": "main",
            "index": 0
          },
          {
            "node": "Logistics Network1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Decision Agent1": {
      "main": [
        [
          {
            "node": "Append or update row in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DPP Missing Data Check": {
      "main": [
        [
          {
            "node": "If Complete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Batch mapping": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate feedback": {
      "main": [
        [
          {
            "node": "Update sheet: FLAGGED",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Shipment authorized": {
      "main": [
        [
          {
            "node": "Update sheet: GOOD",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update sheet: FLAGGED": {
      "main": [
        [
          {
            "node": "Respond to Webhook FLAGGED",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update sheet: GOOD": {
      "main": [
        [
          {
            "node": "Respond to Webhook GOOD",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "route compliance agent": {
      "main": [
        [
          {
            "node": "Append or update row in sheet5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Logistics Network",
            "type": "main",
            "index": 0
          },
          {
            "node": "Download file1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Download file",
            "type": "main",
            "index": 0
          },
          {
            "node": "NonCompliantData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Logistics Network": {
      "main": [
        [
          {
            "node": "Merge Datasets1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge Datasets1": {
      "main": [
        [
          {
            "node": "Dijkstra Solver",
            "type": "main",
            "index": 0
          },
          {
            "node": "Append or update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "weather forecast": {
      "main": [
        [
          {
            "node": "Parse Weather & Assess Risk",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "add cities": {
      "main": [
        [
          {
            "node": "map input for agent",
            "type": "main",
            "index": 0
          },
          {
            "node": "Append or update row in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "weather forecast",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Weather & Assess Risk": {
      "main": [
        [
          {
            "node": "add cities",
            "type": "main",
            "index": 0
          },
          {
            "node": "map input for agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "map input for agent": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "batch compliance agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "map input for agent1": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "route compliance agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge2": {
      "main": [
        [
          {
            "node": "Decision Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Decision Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Generate feedback",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Shipment authorized",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dijkstra Solver": {
      "main": [
        [
          {
            "node": "DPP Missing Data Check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Route_Knowledge",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "Insert Data to Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Insert Data to Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Download file": {
      "main": [
        [
          {
            "node": "Insert Data to Store",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route_Knowledge": {
      "ai_tool": [
        [
          {
            "node": "route compliance agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "route compliance agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "batch compliance agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "DPP_knowledge",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "Insert Data to Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader1": {
      "ai_document": [
        [
          {
            "node": "Insert Data to Store1",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Download file1": {
      "main": [
        [
          {
            "node": "Insert Data to Store1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DPP_knowledge": {
      "ai_tool": [
        [
          {
            "node": "batch compliance agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "CompliantData": {
      "main": [
        []
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "batch compliance agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser1": {
      "ai_outputParser": [
        [
          {
            "node": "route compliance agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "clean_batch": {
      "main": [
        [
          {
            "node": "batch_cert_error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "batch_cert_error": {
      "main": [
        [
          {
            "node": "batch_percentage_error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "batch_percentage_error": {
      "main": [
        [
          {
            "node": "batch_multiple_errors",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser2": {
      "ai_outputParser": [
        [
          {
            "node": "Decision Agent1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet4": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet5": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Append or update row in sheet3": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Logistics Network1": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert Data to Store1": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert Data to Store": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "CompliantData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Logistics Network",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NonCompliantData": {
      "main": [
        [
          {
            "node": "Merge Datasets1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "e3899abd-6bb4-421c-b28d-c769060eb96b",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "81bb26d0ed1f3dd0a3a58476f6b06e9ecf66ead35e6d6ba63f0d8005867dd888"
  },
  "id": "yuLQWHdnksp0sBjG",
  "tags": []
}